/*
 * This file was generated by the Gradle 'init' task.
 */

plugins {
	id 'groovy'
}

description = 'dbdeploy-cli'


configurations {
	drivers
}


dependencies {
	compile project(':dbdeploy-core'),
	        'commons-cli:commons-cli:1.4'

	//fixme: REPLACE WITH THIS! https://stackoverflow.com/a/5648565/9359631
	testCompile project(':dbdeploy-core').sourceSets.test.output

	testImplementation 'org.spockframework:spock-core:1.3-groovy-2.5',
	                   'net.bytebuddy:byte-buddy:1.9.13',
	                   'org.apache.commons:commons-io:1.3.2',
	                   'org.xerial:sqlite-jdbc:3.27.2.+'

	drivers 'org.xerial:sqlite-jdbc:3.27.2.+'
}


task fatJar(type: Jar) {
	manifest {
		attributes 'Implementation-Title': 'dbdeploy-cli',
		           'Implementation-Version': version,
		           'Main-Class': 'com.dbdeploy.CommandLineTarget'
	}

	//noinspection GroovyAssignabilityCheck
	archiveBaseName.set project.name + '-all'

	from {
		configurations.compile.collect { it.isDirectory() ? it : zipTree(it) }
	}
	with jar
}


//https://discuss.gradle.org/t/download-some-dependencies-and-copy-them-to-a-local-folder/6246/2
task copyDrivers(type: Copy) {
	from configurations.drivers
	into "$buildDir/libs"
}


test.dependsOn fatJar, copyDrivers
